<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode | default "en-us" }}">
<head>
    {{ partial "head.html" . }}
    <link rel="stylesheet" href="/css/freelancers.css">
</head>
<body>
    {{ partial "header.html" . }}
    <main class="content-page container pt-7 pb-5">
        <h3>Find contractors or freelancers from our community</h3>
        <div class="row info-boxes freelancers-width">
            <div class="col-md-6">
                <div class="info-box">
                    <p>Looking for talent? Join the <a href="https://bcneng.slack.com/archives/C6JH3Q69F">#contractors-freelancers</a> channel to connect with our community.</p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="info-box">
                    <p>Looking for gigs? Add yourself:</p>
                    <ol class="howto-steps">
                        <li><a href="https://moshfeu.medium.com/how-to-find-my-member-id-in-slack-workspace-d4bba942e38c" target="_blank" rel="noopener">Locate</a> your Slack member ID</li>
                        <li>Edit the <a href="https://github.com/bcneng/website/edit/main/data/freelancers.json" target="_blank" rel="noopener">data source</a> and submit a pull request</li>
                        <li>Your profile appears once approved</li>
                    </ol>
                </div>
            </div>
        </div>
        <div class="row freelancers-width">
            <div class="col">
                <div id="skill-cloud" class="skill-cloud">
                    {{ $allSkills := slice }}
                    {{ range $.Site.Data.freelancers }}
                        {{ range .skills }}
                            {{ $allSkills = $allSkills | append . }}
                        {{ end }}
                    {{ end }}

                    {{ $uniqueSkills := $allSkills | uniq }}
                    {{ $skillGroups := dict }}

                    {{ range $skill := $uniqueSkills }}
                        {{ $skillLower := trim $skill " " | lower }}
                        {{ $skillNorm := $skillLower }}

                        {{ if or (in $skillLower "postgres") (in $skillLower "mysql") (in $skillLower "sql") }}
                            {{ $skillNorm = "relationaldb" }}
                        {{ else if in $skillLower "typescript" }}
                            {{ $skillNorm = "typescript" }}
                        {{ else if in $skillLower "architecture" }}
                            {{ $skillNorm = "architecture" }}
                        {{ else if in $skillLower "ci/cd" }}
                            {{ $skillNorm = "cicd" }}
                        {{ else if in $skillLower "swift" }}
                            {{ $skillNorm = "swift" }}
                        {{ else if or (in $skillLower "k8s") (in $skillLower "kubernetes") }}
                            {{ $skillNorm = "kubernetes" }}
                        {{ else if in $skillLower "angular" }}
                            {{ $skillNorm = "angular" }}
                        {{ else if in $skillLower "php" }}
                            {{ $skillNorm = "php" }}
                        {{ else if in $skillLower "testing" }}
                            {{ $skillNorm = "testing" }}
                        {{ else if in $skillLower "react" }}
                            {{ $skillNorm = "react" }}
                        {{ else if in $skillLower "spring" }}
                            {{ $skillNorm = "spring" }}
                        {{ else if or (in $skillLower "node") (in $skillLower "nodejs") }}
                            {{ $skillNorm = "node" }}
                        {{ else }}
                            {{ $skillNorm = replace $skillNorm "golang" "go" }}
                            {{ $skillNorm = replace $skillNorm "javascript" "js" }}
                            {{ $skillNorm = replace $skillNorm "." "" }}
                            {{ $skillNorm = replace $skillNorm "-" "" }}
                            {{ $skillNorm = replace $skillNorm " " "" }}
                            {{ $skillNorm = replace $skillNorm "/" "" }}
                        {{ end }}

                        {{ $existing := index $skillGroups $skillNorm }}
                        {{ if $existing }}
                            {{ $existing = $existing | append $skill }}
                            {{ $skillGroups = merge $skillGroups (dict $skillNorm $existing) }}
                        {{ else }}
                            {{ $skillGroups = merge $skillGroups (dict $skillNorm (slice $skill)) }}
                        {{ end }}
                    {{ end }}

                    {{ $displayedSkills := dict }}
                    {{ range $normKey, $skillList := $skillGroups }}
                        {{ $displayName := "" }}
                        {{ if eq $normKey "relationaldb" }}
                            {{ $displayName = "Relational DBs" }}
                        {{ else if eq $normKey "typescript" }}
                            {{ $displayName = "TypeScript" }}
                        {{ else if eq $normKey "architecture" }}
                            {{ $displayName = "Architecture" }}
                        {{ else if eq $normKey "cicd" }}
                            {{ $displayName = "CI/CD" }}
                        {{ else if eq $normKey "swift" }}
                            {{ $displayName = "Swift" }}
                        {{ else if eq $normKey "kubernetes" }}
                            {{ $displayName = "Kubernetes" }}
                        {{ else if eq $normKey "angular" }}
                            {{ $displayName = "Angular" }}
                        {{ else if eq $normKey "php" }}
                            {{ $displayName = "PHP" }}
                        {{ else if eq $normKey "testing" }}
                            {{ $displayName = "Testing" }}
                        {{ else if eq $normKey "react" }}
                            {{ $displayName = "React" }}
                        {{ else if eq $normKey "spring" }}
                            {{ $displayName = "Spring" }}
                        {{ else if eq $normKey "node" }}
                            {{ $displayName = "Node" }}
                        {{ else }}
                            {{ $shortest := index $skillList 0 }}
                            {{ range $s := $skillList }}
                                {{ if lt (len $s) (len $shortest) }}
                                    {{ $shortest = $s }}
                                {{ end }}
                            {{ end }}
                            {{ $displayName = $shortest }}
                        {{ end }}

                        {{ $wordCount := len (split $displayName " ") }}
                        {{ if and (le $wordCount 3) (le (len $displayName) 20) }}
                            {{ $displayedSkills = merge $displayedSkills (dict $displayName $skillList) }}
                        {{ end }}
                    {{ end }}

                    {{ $colors := slice "#4a90e2" "#e74c3c" "#2ecc71" "#f39c12" "#9b59b6" "#1abc9c" "#e67e22" "#3498db" "#c0392b" "#16a085" "#d35400" "#8e44ad" "#27ae60" "#e84393" "#fd79a8" "#00b894" "#0984e3" "#6c5ce7" "#fdcb6e" "#d63031" "#00cec9" "#ff7675" "#74b9ff" "#a29bfe" "#55efc4" "#ffeaa7" "#fab1a0" "#ff7979" "#e17055" "#81ecec" "#ff6b6b" "#4ecdc4" "#45b7d1" "#f7b731" "#5f27cd" "#00d2d3" "#ee5a6f" "#c44569" "#f8b500" "#6ab04c" "#eb4d4b" "#e056fd" "#686de0" "#f9ca24" "#eb3b5a" "#fc5c65" "#20bf6b" "#0fb9b1" "#26de81" "#45aaf2" "#4b7bec" "#a55eea" "#fa8231" "#fd9644" "#fed330" "#2bcbba" "#22a6b3" "#be2edd" "#4834d4" "#f0932b" "#6c5ce7" }}
                    {{ $skillColors := dict }}
                    {{ $colorIndex := 0 }}

                    {{ range $normKey, $skillList := $skillGroups }}
                        {{ $color := index $colors (mod $colorIndex (len $colors)) }}
                        {{ range $s := $skillList }}
                            {{ $skillColors = merge $skillColors (dict $s $color) }}
                        {{ end }}
                        {{ $colorIndex = add $colorIndex 1 }}
                    {{ end }}

                    {{ $index := 0 }}
                    {{ range $display, $originals := $displayedSkills }}
                        {{ $color := index $skillColors (index $originals 0) }}
                        <span class="skill-tag" data-skill="{{ $display }}" data-originals="{{ delimit $originals "||" }}" style="border-left-color: {{ $color }};">{{ title $display }}</span>
                        {{ $index = add $index 1 }}
                    {{ end }}
                    <script>
                        window.skillColors = {{ $skillColors | jsonify | safeJS }};
                    </script>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col tablewrapper" id="freelancers-container">
                {{ partial "freelancers_list.html" . }}
            </div>
        </div>
    </main>

    {{ partial "footer.html" . }}
    {{ partial "foot.html" . }}

    <script>
        (function() {
            // Apply colors to all skills on page load and add click handlers
            if (window.skillColors) {
                document.querySelectorAll('.skill[data-skill-name]').forEach(skillSpan => {
                    const skillName = skillSpan.getAttribute('data-skill-name');
                    const color = window.skillColors[skillName];
                    if (color) {
                        skillSpan.style.borderLeftColor = color;
                        skillSpan.addEventListener('mouseenter', function() {
                            this.style.backgroundColor = color;
                        });
                        skillSpan.addEventListener('mouseleave', function() {
                            // Only reset if not highlighted
                            if (!this.classList.contains('highlighted')) {
                                this.style.backgroundColor = '';
                            }
                        });
                        skillSpan.addEventListener('click', function() {
                            // Find the matching skill tag in the cloud and trigger its click
                            const matchingTag = Array.from(document.querySelectorAll('.skill-tag')).find(tag => {
                                const originals = tag.getAttribute('data-originals').split('||');
                                return originals.includes(skillName);
                            });
                            if (matchingTag) {
                                matchingTag.click();
                                matchingTag.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            }
                        });
                    }
                });
            }

            // Add hover effect to skill tags in cloud
            document.querySelectorAll('.skill-tag').forEach(tag => {
                const color = tag.style.borderLeftColor;
                tag.addEventListener('mouseenter', function() {
                    this.style.backgroundColor = color;
                });
                tag.addEventListener('mouseleave', function() {
                    if (!this.classList.contains('active')) {
                        this.style.backgroundColor = '';
                    }
                });
            });

            const skillTags = document.querySelectorAll('.skill-tag');
            const freelancerCards = document.querySelectorAll('.freelancer-card');
            let activeSkill = null;

            skillTags.forEach(tag => {
                tag.addEventListener('click', function() {
                    const skill = this.getAttribute('data-skill');
                    const originals = this.getAttribute('data-originals').split('||');

                    if (activeSkill === skill) {
                        // Deselect if clicking the same skill - instant, no animation
                        activeSkill = null;
                        this.classList.remove('active');
                        const originalLeftColor = this.style.borderLeftColor;
                        this.style.transition = 'none';
                        this.style.backgroundColor = '';
                        this.style.border = '1px solid #c3c3c3';
                        this.style.borderLeft = `3px solid ${originalLeftColor}`;
                        this.style.color = '';
                        this.style.transform = '';
                        // Force reflow to apply the instant change
                        this.offsetHeight;
                        this.style.transition = '';
                        showAllFreelancers();
                    } else {
                        // Remove previous active state - instant
                        skillTags.forEach(t => {
                            t.classList.remove('active');
                            if (!t.matches(':hover')) {
                                const originalLeftColor = t.style.borderLeftColor;
                                t.style.transition = 'none';
                                t.style.backgroundColor = '';
                                t.style.border = '1px solid #c3c3c3';
                                t.style.borderLeft = `3px solid ${originalLeftColor}`;
                                t.style.color = '';
                                t.style.transform = '';
                                t.offsetHeight;
                                t.style.transition = '';
                            }
                        });

                        // Set new active skill - with animation
                        activeSkill = skill;
                        this.classList.add('active');
                        const tagColor = this.style.borderLeftColor;
                        this.style.backgroundColor = tagColor;
                        filterFreelancers(originals);
                    }
                });
            });

            function filterFreelancers(skillVariations) {
                freelancerCards.forEach(card => {
                    const skills = card.getAttribute('data-skills').split(',');
                    const hasSkill = skillVariations.some(variation => skills.includes(variation));

                    // Show/hide card
                    if (hasSkill) {
                        card.style.display = '';
                    } else {
                        card.style.display = 'none';
                    }

                    // Highlight matching skills in card
                    const cardSkills = card.querySelectorAll('.skill');
                    cardSkills.forEach(skillSpan => {
                        const skillText = skillSpan.textContent.trim();
                        const skillName = skillSpan.getAttribute('data-skill-name');

                        if (skillVariations.includes(skillText) || skillVariations.includes(skillName)) {
                            skillSpan.classList.add('highlighted');
                            const color = window.skillColors[skillName] || window.skillColors[skillText];
                            if (color) {
                                skillSpan.style.backgroundColor = color;
                            }
                        } else {
                            skillSpan.classList.remove('highlighted');
                            skillSpan.style.backgroundColor = '';
                        }
                    });
                });
            }

            function showAllFreelancers() {
                freelancerCards.forEach(card => {
                    card.style.display = '';

                    // Remove all highlights
                    const cardSkills = card.querySelectorAll('.skill');
                    cardSkills.forEach(skillSpan => {
                        skillSpan.classList.remove('highlighted');
                        skillSpan.style.backgroundColor = '';
                    });
                });
            }
        })();
    </script>

    {{ template "_internal/google_analytics.html" . }}
</body>
</html>
